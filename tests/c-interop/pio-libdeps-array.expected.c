/**
 * Generated by C-Next Transpiler
 * A safer C for embedded systems
 */

#include "pio-libdeps-array.test.h"

// Issue #355: Array member access through pointer should not generate static_cast
// Regression test for PlatformIO library dependency header parsing
// Tests that array fields from external C++ struct headers are correctly detected
// Simulate a minimal C++ struct with an array field (like CAN_message_t from FlexCAN_T4)
#include "mock_can.h"

#include <stdint.h>

// ADR-044: Overflow helper functions
#include <limits.h>

static inline uint8_t cnx_clamp_add_u8(uint8_t a, uint32_t b) {
    if (b > (uint32_t)(UINT8_MAX - a)) return UINT8_MAX;
    uint8_t result;
    if (__builtin_add_overflow(a, (uint8_t)b, &result)) return UINT8_MAX;
    return result;
}

/* Scope: PioArrayTest */

void PioArrayTest_processBuffer(const uint8_t data[8], uint8_t len) {
    uint8_t sum = 0U;
    for (uint8_t i = 0; i < len; i += 1) {
        sum = cnx_clamp_add_u8(sum, data[i]);
    }
}

void PioArrayTest_handleMessage(const MockCanMessage* msg) {
    if (msg->id != 0) {
        PioArrayTest_processBuffer(msg->buf, 8);
    }
}
