// test-c-only
// test-execution
// Tests: assigning cross-file enum struct member to local variable (#786)

#include "types.cnx"

u32 main() {
    // Initialize config
    config.items[0].assigned <- MyEnum.A;
    config.items[1].assigned <- MyEnum.B;
    config.items[2].assigned <- MyEnum.NONE;
    config.items[3].assigned <- MyEnum.A;

    // This should work: assign struct member (typed as enum) to local enum variable
    MyEnum val <- config.items[0].assigned;
    if (val != MyEnum.A) return 1;

    // Test in a loop (original reproducer pattern)
    u8 countAssigned <- 0;
    for (u8 i <- 0; i < COUNT; i +<- 1) {
        MyEnum current <- config.items[i].assigned;  // This is the failing line
        if (current != MyEnum.NONE) {
            countAssigned +<- 1;
        }
    }

    // Should have found 3 assigned (A, B, A - not NONE)
    if (countAssigned != 3) return 2;

    return 0;
}
