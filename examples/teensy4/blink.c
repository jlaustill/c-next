/**
 * Generated by C-Next Transpiler
 * A safer C for embedded systems
 */

#include "blink.h"

// blink.cnx - LED Blink for Teensy 4.x (Scoped Register Demo)
// Target: Teensy 4.x (NXP i.MX RT1062)
// Built-in LED is on GPIO7, bit 3 (Arduino pin 13)
//
// Compile: cnx blink.cnx -o blink.c
// Then use with Arduino/PlatformIO
//
// This example demonstrates SCOPED REGISTERS (ADR-016) with separation of concerns:
//
// Architecture:
//   scope Teensy4 { ... }  - Platform layer: registers, bitmaps, enums, constants
//   scope LED { ... }      - Application layer: high-level LED control functions
//   global                 - Sketch config: BLINK_DELAY_MS, setup(), loop()
//
// Cross-scope access (ADR-016 requires global. prefix):
//   LED.toggle()                                               - Call application function
//   global.Teensy4.GPIO7.DataRegister_Set.LED_BUILTIN <- true  - Access platform register
//
// Why scoped registers?
// - Avoids conflicts with HAL headers (Teensy's imxrt.h defines GPIO7_DR)
// - Groups platform-specific types, registers, constants together
// - Enables multi-platform codebases with clear organization
//
// See docs/README.md for GPIO7 pin mapping and register documentation.
// =============================================================================
// Includes - C-Next passes these through to generated C
// =============================================================================
#include <Arduino.h>
#include <stdint.h>
#include <stdbool.h>

#include <stdint.h>
#include <stdbool.h>

// =============================================================================
// Teensy 4.x Platform Scope
// =============================================================================
// All platform-specific definitions are scoped to avoid HAL conflicts.
// Generates: Teensy4_GPIO7_DR, Teensy4_GPIO7Pins, Teensy4_InterruptType, etc.
/* Scope: Teensy4 */

/* Register: Teensy4_GPIO7 @ 0x42004000 */
#define Teensy4_GPIO7_DataRegister (*(volatile Teensy4_GPIO7Pins*)(0x42004000 + 0x00))
#define Teensy4_GPIO7_DirectionRegister (*(volatile Teensy4_GPIO7Pins*)(0x42004000 + 0x04))
#define Teensy4_GPIO7_PadStatusRegister (*(volatile Teensy4_GPIO7Pins const *)(0x42004000 + 0x08))
#define Teensy4_GPIO7_InterruptConfig1 (*(volatile Teensy4_ICR1Config*)(0x42004000 + 0x0C))
#define Teensy4_GPIO7_InterruptMaskRegister (*(volatile Teensy4_GPIO7Pins*)(0x42004000 + 0x14))
#define Teensy4_GPIO7_InterruptStatus (*(volatile Teensy4_GPIO7Pins*)(0x42004000 + 0x18))
#define Teensy4_GPIO7_DataRegister_Set (*(volatile Teensy4_GPIO7Pins*)(0x42004000 + 0x84))
#define Teensy4_GPIO7_DataRegister_Clear (*(volatile Teensy4_GPIO7Pins*)(0x42004000 + 0x88))
#define Teensy4_GPIO7_DataRegister_Toggle (*(volatile Teensy4_GPIO7Pins*)(0x42004000 + 0x8C))


static uint8_t Teensy4_doSomething(void) {
    uint8_t someByte = 123;
    uint8_t nextByte = someByte;
}

// =============================================================================
// LED Control (Application-level, not platform-specific)
// =============================================================================
// LED functions use the Teensy4 platform scope for hardware access.
/* Scope: LED */

void LED_on(void) {
    Teensy4_GPIO7_DataRegister_Set = (1 << 3);
}

void LED_off(void) {
    Teensy4_GPIO7_DataRegister_Clear = (1 << 3);
}

void LED_toggle(void) {
    Teensy4_GPIO7_DataRegister_Toggle = (1 << 3);
}

bool LED_isOn(void) {
    return ((Teensy4_GPIO7_PadStatusRegister >> 3) & 1);
}

void LED_configureInterrupt(void) {
    Teensy4_GPIO7_InterruptConfig1 = (Teensy4_GPIO7_InterruptConfig1 & ~(0x3 << 6)) | (((uint8_t)Teensy4_InterruptType_RISING_EDGE & 0x3) << 6);
    Teensy4_GPIO7_InterruptMaskRegister = (Teensy4_GPIO7_InterruptMaskRegister & ~(1 << 3)) | (1 << 3);
}

void LED_clearInterrupt(void) {
    Teensy4_GPIO7_InterruptStatus = (Teensy4_GPIO7_InterruptStatus & ~(1 << 3)) | (1 << 3);
}

// =============================================================================
// Sketch Configuration (user-level, not platform-specific)
// =============================================================================
const uint32_t BLINK_DELAY_MS = 1000;

// =============================================================================
// Arduino Entry Points
// =============================================================================
void setup(void) {
    pinMode(LED_BUILTIN, OUTPUT);
}

void loop(void) {
    LED_toggle();
    delay(BLINK_DELAY_MS);
}
