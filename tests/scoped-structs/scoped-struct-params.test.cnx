// test-execution
// Tests: Scoped structs passed as function parameters

scope Math {
    public struct Vec2 {
        i32 x;
        i32 y;
    }

    public void add(this.Vec2 result, this.Vec2 a, this.Vec2 b) {
        result.x <- a.x + b.x;
        result.y <- a.y + b.y;
    }

    public void scale(this.Vec2 v, i32 factor) {
        v.x <- v.x * factor;
        v.y <- v.y * factor;
    }

    public i32 dot(this.Vec2 a, this.Vec2 b) {
        return a.x * b.x + a.y * b.y;
    }

    public bool equals(this.Vec2 a, this.Vec2 b) {
        if (a.x = b.x && a.y = b.y) {
            return true;
        }
        return false;
    }

    public void copy(this.Vec2 dest, this.Vec2 src) {
        dest.x <- src.x;
        dest.y <- src.y;
    }
}

u32 main() {
    Math.Vec2 v1;
    Math.Vec2 v2;
    Math.Vec2 result;

    // Test 1: Initialize vectors
    v1.x <- 3;
    v1.y <- 4;
    v2.x <- 1;
    v2.y <- 2;

    // Test 2: Add vectors
    Math.add(result, v1, v2);
    if (result.x != 4) return 1;  // 3 + 1
    if (result.y != 6) return 2;  // 4 + 2

    // Test 3: Scale vector
    Math.scale(v1, 2);
    if (v1.x != 6) return 3;  // 3 * 2
    if (v1.y != 8) return 4;  // 4 * 2

    // Test 4: Dot product
    v1.x <- 2;
    v1.y <- 3;
    v2.x <- 4;
    v2.y <- 5;
    i32 dp <- Math.dot(v1, v2);
    if (dp != 23) return 5;  // 2*4 + 3*5 = 8 + 15 = 23

    // Test 5: Equality check
    v1.x <- 10;
    v1.y <- 20;
    v2.x <- 10;
    v2.y <- 20;
    bool eq <- Math.equals(v1, v2);
    if (eq != true) return 6;

    v2.y <- 21;
    eq <- Math.equals(v1, v2);
    if (eq != false) return 7;

    // Test 6: Copy
    Math.copy(result, v1);
    if (result.x != 10) return 8;
    if (result.y != 20) return 9;

    return 0;
}
