// tests/functions/const-struct-member-cpp.test.cnx
/* test-execution */
// Tests: Issue #251 - const struct members passed to non-const parameters
// In C++ mode, passing &const_struct->member to non-const T* is invalid
// Must copy to temp variable first

#include "const-struct-member-cpp.h"

u32 process(u32 crc, u8 byte) {
    return crc ^ byte;
}

u32 testConstStruct(const TestConfig cfg) {
    u32 crc <- 0;
    // This should generate: uint8_t _cnx_tmp = cfg->value; process(&crc, &_cnx_tmp);
    // NOT: process(&crc, &cfg->value); which gives: Error const uint8_t* to uint8_t*
    crc <- process(crc, cfg.value);
    return crc;
}

u32 main() {
    TestConfig cfg;
    cfg.value <- 0x42;
    cfg.flags <- 0xFF;

    u32 result <- testConstStruct(cfg);
    if (result != 0x42) return 1;

    return 0;
}
