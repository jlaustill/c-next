// test-c-only
// test-coverage: 33.2-critical-inside-loop
// Coverage: Section 7.7, 33.2 - Critical section inside loops
// Tests: critical sections inside for, while, and do-while loops
u32[10] sharedData;

u32 counter <- 0;

void criticalInFor() {
    for (u32 i <- 0; i < 10; i <- i + 1) {
        critical {
            sharedData[i] <- i * 2;
            counter +<- 1;
        }
    }
}

void criticalInWhile() {
    u32 i <- 0;
    while (i < 5) {
        critical {
            sharedData[i] +<- 1;
        }
        i +<- 1;
    }
}

void criticalInDoWhile() {
    u32 i <- 0;
    do {
        critical {
            counter +<- 1;
        }
        i +<- 1;
    } while (i < 3);
}

void criticalInNestedLoop() {
    for (u32 i <- 0; i < 3; i <- i + 1) {
        for (u32 j <- 0; j < 3; j <- j + 1) {
            critical {
                sharedData[i] +<- j;
            }
        }
    }
}

void main() {
    criticalInFor();
    criticalInWhile();
    criticalInDoWhile();
    criticalInNestedLoop();
}
