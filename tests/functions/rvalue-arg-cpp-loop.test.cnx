/* test-execution */
// Tests: Issue #250 edge case - rvalue expressions in control flow conditions
// Verifies temp var placement before control flow statements (not inside body)

#include "rvalue-arg-cpp.h"

u32 checkValue(u8 x) {
    return x;
}

u32 main() {
    u8 a <- 5;
    u8 b <- 3;
    u32 result <- 0;

    // Test 1: rvalue expression (a + b) in if condition
    // Temp var for (a + b) should be declared BEFORE the if
    if (checkValue(a + b) > 5) {
        result <- 1;
    }
    if (result != 1) return 1;  // 5 + 3 = 8 > 5, so result should be 1

    // Test 2: rvalue expression in while condition
    // Note: Since temp is hoisted before loop, it's only evaluated once
    // This test uses a constant expression to verify compilation works
    u8 iterations <- 0;
    u8 limit <- 2;
    while (checkValue(limit + 1) > iterations) {
        iterations <- iterations + 1;
        if (iterations > 10) return 2;  // Safety: prevent infinite loop
    }
    // limit + 1 = 3, evaluated once, so loops while iterations < 3
    if (iterations != 3) return 3;

    // Test 3: rvalue expression in for loop condition (not using loop var)
    // Note: Using loop var in rvalue would cause scoping issues
    u32 sum <- 0;
    u8 maxVal <- 3;
    for (u8 i <- 0; i < checkValue(maxVal + 1); i <- i + 1) {
        sum <- sum + 1;
    }
    // maxVal + 1 = 4, so loops while i < 4 (i=0,1,2,3)
    if (sum != 4) return 4;

    return 0;
}
