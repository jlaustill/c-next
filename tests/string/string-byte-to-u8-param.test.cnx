// test-execution
/* test-no-warnings */
// Regression test for Issue #246 - string<N> byte indexing to u8 parameters
// Verifies passing buf[0] to u8 parameter generates correct types
// (was generating char* instead of uint8_t*)

scope ByteProcessor {
    // Function that takes a u8 byte and XORs it with a value
    u32 processByte(u32 crc, u8 byte) {
        return crc ^ byte;
    }

    // Function that uses string<N> as a byte buffer and passes bytes to processByte
    public u32 processBuffer() {
        string<4> buf <- "ABCD";
        u32 crc <- 0;

        // Pass string bytes directly to u8 parameter
        crc <- this.processByte(crc, buf[0]);  // 'A' = 0x41
        crc <- this.processByte(crc, buf[1]);  // 'B' = 0x42
        crc <- this.processByte(crc, buf[2]);  // 'C' = 0x43
        crc <- this.processByte(crc, buf[3]);  // 'D' = 0x44

        return crc;
    }
}

u32 main() {
    // Expected: 0 ^ 0x41 ^ 0x42 ^ 0x43 ^ 0x44 = 0x04
    u32 result <- ByteProcessor.processBuffer();
    if (result != 0x04) return 1;

    return 0;
}
