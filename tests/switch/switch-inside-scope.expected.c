/**
 * Generated by C-Next Transpiler
 * A safer C for embedded systems
 */

#include <stdint.h>

// ADR-044: Overflow helper functions
#include <limits.h>

static inline uint32_t cnx_clamp_add_u32(uint32_t a, uint64_t b) {
    if (b > UINT32_MAX - a) return UINT32_MAX;
    return a + (uint32_t)b;
}

// Coverage: Section 7.5 - switch statement inside scope
// Tests: switch statements inside scope method declarations
// Also tests: this.EnumName.VALUE syntax in case labels (Issue #147)
uint32_t globalResult = 0;

/* Scope: StateMachine */

typedef enum {
    StateMachine_EState_IDLE = 0,
    StateMachine_EState_RUNNING = 1,
    StateMachine_EState_PAUSED = 2,
    StateMachine_EState_STOPPED = 3
} StateMachine_EState;

StateMachine_EState StateMachine_currentState = StateMachine_EState_IDLE;
uint32_t StateMachine_counter = 0;

void StateMachine_processState(void) {
    switch (StateMachine_currentState) {
        case StateMachine_EState_IDLE: {
            StateMachine_counter = 0;
            break;
        }
        case StateMachine_EState_RUNNING: {
            StateMachine_counter = cnx_clamp_add_u32(StateMachine_counter, 1);
            break;
        }
        case StateMachine_EState_PAUSED: {
            break;
        }
        case StateMachine_EState_STOPPED: {
            StateMachine_counter = 100;
            break;
        }
    }
}

void StateMachine_setRunning(void) {
    StateMachine_currentState = StateMachine_EState_RUNNING;
}

void StateMachine_setStopped(void) {
    StateMachine_currentState = StateMachine_EState_STOPPED;
}

uint32_t StateMachine_getCounter(void) {
    return StateMachine_counter;
}

/* Scope: CommandProcessor */
uint32_t CommandProcessor_lastCommand = 0;
uint32_t CommandProcessor_result = 0;

void CommandProcessor_execute(uint32_t* command) {
    CommandProcessor_lastCommand = (*command);
    switch ((*command)) {
        case 1: {
            CommandProcessor_result = 100;
            break;
        }
        case 2: {
            CommandProcessor_result = 200;
            break;
        }
        case 3: {
            CommandProcessor_result = 300;
            break;
        }
        default: {
            CommandProcessor_result = 0;
            break;
        }
    }
}

uint32_t CommandProcessor_getResult(void) {
    return CommandProcessor_result;
}

void main(void) {
    StateMachine_setRunning();
    StateMachine_processState();
    globalResult = StateMachine_getCounter();
    CommandProcessor_execute(&(uint32_t){2});
    globalResult = CommandProcessor_getResult();
}
