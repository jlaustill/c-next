// test-cpp-only
// test-execution
// Test: ESP-IDF style config with bitfields (issue #882 real-world case)
#include "anon_types.h"

i32 main() {
    // Test 1: ESP-IDF style with bitfields
    PanelConfig panel <- {
        clk_src: 1,
        timings: { pclk_hz: 16000000, h_res: 800, v_res: 480 },
        flags: { fb_in_psram: 1, double_fb: 0, no_fb: 0, bb_invalidate_cache: 1 }
    };

    if (panel.clk_src != 1) return 1;
    if (panel.timings.pclk_hz != 16000000) return 2;
    if (panel.timings.h_res != 800) return 3;
    if (panel.timings.v_res != 480) return 4;
    if (panel.flags.fb_in_psram != 1) return 5;
    if (panel.flags.double_fb != 0) return 6;
    if (panel.flags.bb_invalidate_cache != 1) return 7;

    // Test 2: Minimal init
    PanelConfig panel2 <- {
        clk_src: 0,
        timings: { pclk_hz: 8000000, h_res: 320, v_res: 240 },
        flags: { fb_in_psram: 0 }
    };

    if (panel2.clk_src != 0) return 8;
    if (panel2.timings.pclk_hz != 8000000) return 9;
    if (panel2.timings.h_res != 320) return 10;
    if (panel2.flags.fb_in_psram != 0) return 11;

    return 0;
}
