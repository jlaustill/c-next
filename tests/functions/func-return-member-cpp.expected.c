/**
 * Generated by C-Next Transpiler
 * A safer C for embedded systems
 */

// tests/functions/func-return-member-cpp.test.cnx
/* test-execution */
// Tests: Issue #256 - function return member passing in C++ mode
// When passing getConfig().member to u8 parameter, must generate temp variable
// because bool* and enum* cannot convert to uint8_t* in C++
#include "func-return-member-cpp.h"

#include <stdint.h>
#include <stdbool.h>

// Global config for the getter to return
DeviceConfig globalConfig = {0};

// Function that returns a struct by value
DeviceConfig getConfig(void) {
    return globalConfig;
}

uint32_t process(uint32_t* crc, uint8_t* byte) {
    return (*crc) ^ (*byte);
}

uint32_t testFuncReturnMember(void) {
    uint32_t crc = 0;
    globalConfig.enabled = true;
    globalConfig.mode = MODE_AUTO;
    globalConfig.value = 42;
    uint8_t _cnx_tmp_0 = static_cast<uint8_t>(getConfig().enabled);
    crc = process(&crc, &_cnx_tmp_0);
    uint8_t _cnx_tmp_1 = static_cast<uint8_t>(getConfig().mode);
    crc = process(&crc, &_cnx_tmp_1);
    uint8_t _cnx_tmp_2 = static_cast<uint8_t>(getConfig().value);
    crc = process(&crc, &_cnx_tmp_2);
    return crc;
}

int main(void) {
    uint32_t result = testFuncReturnMember();
    if (result != 41) return 1;
    return 0;
}
