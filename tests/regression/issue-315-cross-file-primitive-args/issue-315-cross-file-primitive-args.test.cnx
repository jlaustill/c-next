// Issue #315: Cross-file calls incorrectly add & to primitive struct member arguments
// NOTE: This is a compilation-only test - cross-file tests cannot execute without multi-file linking
// When calling a function in another file via global.ScopeName.function(),
// primitive struct member arguments should NOT have & added.

#include <TestFunc.cnx>

struct TestData {
    f32 value1;
    f32 value2;
}

scope TestCaller {
    TestData data;

    public void init() {
        this.data.value1 <- 0.0;
        this.data.value2 <- 0.0;
    }

    public f32 test() {
        this.data.value1 <- 1.5;
        this.data.value2 <- 2.5;

        // Cross-file call - should NOT add & to primitive struct members
        // Bug: generates TestFunc_addFloats(&TestCaller_data.value1, &TestCaller_data.value2)
        // Expected: TestFunc_addFloats(TestCaller_data.value1, TestCaller_data.value2)
        f32 result <- global.TestFunc.addFloats(this.data.value1, this.data.value2);
        return result;
    }
}

u32 main() {
    TestCaller.init();
    f32 result <- TestCaller.test();

    // 1.5 + 2.5 = 4.0
    if (result != 4.0) return 1;

    return 0;
}
