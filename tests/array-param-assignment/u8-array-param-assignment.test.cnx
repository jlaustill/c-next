// test-execution
// Tests: Issue #368 - Array parameter element assignment generates bitwise ops instead of array access
// When assigning to an array element via function parameter (data[0] <- value),
// the transpiler should generate array access, not bit manipulation.
// Bug: Unsized array parameters (u8[] data) generate bit ops; sized arrays (u8[8] arr) work fine.

// Function that writes to array element by index - UNSIZED parameter (triggers bug)
void writeAt(u8[] arr, u32 index, u8 value) {
    arr[index] <- value;
}

// Function that writes to first element with literal index - UNSIZED parameter
void writeFirst(u8[] data, u8 value) {
    data[0] <- value;
}

// Function that reads and writes array elements - UNSIZED parameters
void copyElement(u8[] src, u8 dst[], u32 index) {
    dst[index] <- src[index];
}

u32 main() {
    // Test 1: Write to array element via function
    u8[8] buffer;
    buffer[0] <- 0;
    buffer[1] <- 0;

    writeAt(buffer, 0, 42);
    if (buffer[0] != 42) return 1;

    // Test 2: Write to different index
    writeAt(buffer, 1, 99);
    if (buffer[1] != 99) return 2;

    // Test 3: writeFirst function with literal index
    writeFirst(buffer, 123);
    if (buffer[0] != 123) return 3;

    // Test 4: Copy element between arrays
    u8[4] source;
    u8[4] dest;
    source[0] <- 0;
    source[1] <- 0;
    source[2] <- 0;
    source[3] <- 0;
    dest[0] <- 0;
    dest[1] <- 0;
    dest[2] <- 0;
    dest[3] <- 0;

    source[2] <- 200;
    copyElement(source, dest, 2);
    if (dest[2] != 200) return 4;

    return 0;
}
