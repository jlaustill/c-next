/**
 * Generated by C-Next Transpiler from: multi-type-forward.test.cnx
 * A safer C for embedded systems
 */

#include "multi-type-forward.test.h"

// test-c-only
// Issue #404: Forward declarations with multiple external types
// test-execution
// Tests forward declarations when multiple structs and enums are used
// from the same external file.
#include <multi-type-forward-types.h>

#include <stdint.h>
#include <stdbool.h>

/* Scope: DeviceManager */
static DeviceConfig DeviceManager_config = {0};
static DeviceStatus DeviceManager_status = {0};

void DeviceManager_configure(const DeviceConfig* newConfig) {
    DeviceManager_config = (*newConfig);
}

DeviceConfig DeviceManager_getConfig(void) {
    return DeviceManager_config;
}

void DeviceManager_setStatus(const DeviceStatus* newStatus) {
    DeviceManager_status = (*newStatus);
}

DeviceStatus DeviceManager_getStatus(void) {
    return DeviceManager_status;
}

EDeviceState DeviceManager_getState(void) {
    return DeviceManager_status.state;
}

int main(void) {
    DeviceConfig cfg = (DeviceConfig){ .baudRate = 115200U, .address = 0x42U };
    DeviceManager_configure(&cfg);
    DeviceConfig retrievedCfg = DeviceManager_getConfig();
    if (retrievedCfg.baudRate != 115200) return 1;
    if (retrievedCfg.address != 0x42) return 2;
    DeviceStatus stat = (DeviceStatus){ .state = EDeviceState_STATE_ACTIVE, .errorCount = 0U, .connected = true };
    DeviceManager_setStatus(&stat);
    DeviceStatus retrievedStat = DeviceManager_getStatus();
    if (retrievedStat.state != EDeviceState_STATE_ACTIVE) return 3;
    if (retrievedStat.errorCount != 0) return 4;
    if (retrievedStat.connected != true) return 5;
    EDeviceState state = DeviceManager_getState();
    if (state != EDeviceState_STATE_ACTIVE) return 6;
    return 0;
}
