/* test-execution */ // Regression test: .length in control flow expressions
// Tests if, while, for, and switch with .length property
struct Packet {
    u32 header;
    u16 length;
    u8 type;
    u64 payload;
}

u32 main() {
    Packet pkt;
    pkt.header <- 0xDEADBEEF;
    pkt.length <- 256;
    pkt.type <- 1;
    pkt.payload <- 0x123456789ABCDEF;

    // Test .length in if condition
    if (pkt.header.length != 32) {
        return 1;
    }

    // Test .length in multiple sequential conditions
    if (pkt.header.length != 32) return 2;
    if (pkt.type.length != 8) return 3;

    // Test .length in while loop condition
    u32 counter <- 0;
    u32 maxBits <- pkt.header.length;
    while ((counter < maxBits) != false) {
        counter +<- 8;
    }
    if (counter != 32) return 4;

    // Test .length in for loop
    u32 totalBits <- 0;
    for (u32 i <- 0; (i < 4) != false; i +<- 1) {
        totalBits +<- pkt.type.length;
    }
    if (totalBits != 32) return 5; // 4 * 8 = 32

    // Test .length in ternary expression
    u32 fieldSize <- ((pkt.header.length > 16) != false) ? 4 : 2;
    if (fieldSize != 4) return 6;

    // Test .length computed in expression assigned to variable used in if
    u32 headerBytes <- pkt.header.length / 8;
    if (headerBytes != 4) {
        return 7;
    }

    // Test multiple .length accesses in nested if
    if (pkt.header.length != 32) {
        return 8;
    }
    if (pkt.payload.length != 64) {
        return 9;
    }

    return 0;
}
