// test-execution
// Tests: Issue #268 - pass-through modification tracking for auto-const
// When a parameter is passed to a function that modifies it,
// the parameter should NOT get const (since it's effectively modified).

// Function that modifies its parameter - should NOT get const
void modifiesParam(u32 value) {
    value <- 42;
}

// Function that passes its parameter to modifiesParam
// Since modifiesParam modifies its param, this param is also modified
// Should NOT get const (pass-through modification)
void passesThroughToModifier(u32 value) {
    modifiesParam(value);
}

// Function that only reads its parameter - SHOULD get const
u32 readOnly(u32 value) {
    return value + 1;
}

// Function that passes to readOnly - parameter is NOT modified
// SHOULD get const since readOnly doesn't modify it
u32 passesThroughToReader(u32 value) {
    return readOnly(value);
}

// Mixed case: reads and passes to modifier
// Should NOT get const because of pass-through to modifier
void mixedPassThrough(u32 value) {
    u32 local <- value + 1;  // Read is fine
    modifiesParam(value);     // But this causes modification
}

u32 main() {
    u32 x <- 10;

    // Test modifiesParam
    modifiesParam(x);
    if (x != 42) return 1;

    // Test passesThroughToModifier
    x <- 100;
    passesThroughToModifier(x);
    if (x != 42) return 2;

    // Test readOnly
    x <- 5;
    u32 result <- readOnly(x);
    if (result != 6) return 3;
    if (x != 5) return 4;  // x should be unchanged

    // Test passesThroughToReader
    x <- 7;
    result <- passesThroughToReader(x);
    if (result != 8) return 5;
    if (x != 7) return 6;  // x should be unchanged

    // Test mixedPassThrough
    x <- 200;
    mixedPassThrough(x);
    if (x != 42) return 7;

    return 0;
}
