// Coverage: Section 7.5 - switch statement inside scope
// Tests: switch statements inside scope method declarations
// Also tests: this.EnumName.VALUE syntax in case labels (Issue #147)

u32 globalResult <- 0;

scope StateMachine {
    public enum EState {
        IDLE,
        RUNNING,
        PAUSED,
        STOPPED
    }

    this.EState currentState <- this.EState.IDLE;
    u32 counter <- 0;

    void processState() {
        switch (this.currentState) {
            case this.EState.IDLE {
                this.counter <- 0;
            }
            case this.EState.RUNNING {
                this.counter +<- 1;
            }
            case this.EState.PAUSED {
                // Do nothing, keep counter
            }
            case this.EState.STOPPED {
                this.counter <- 100;
            }
        }
    }

    void setRunning() {
        this.currentState <- this.EState.RUNNING;
    }

    void setStopped() {
        this.currentState <- this.EState.STOPPED;
    }

    u32 getCounter() {
        return this.counter;
    }
}

scope CommandProcessor {
    u32 lastCommand <- 0;
    u32 result <- 0;

    void execute(u32 command) {
        this.lastCommand <- command;

        switch (command) {
            case 1 {
                this.result <- 100;
            }
            case 2 {
                this.result <- 200;
            }
            case 3 {
                this.result <- 300;
            }
            default(1) {
                this.result <- 0;
            }
        }
    }

    u32 getResult() {
        return this.result;
    }
}

void main() {
    // Test 1: Switch with scoped enum inside scope method
    StateMachine.setRunning();
    StateMachine.processState();
    globalResult <- StateMachine.getCounter();

    // Test 2: Switch with integer cases inside scope
    CommandProcessor.execute(2);
    globalResult <- CommandProcessor.getResult();
}
