/* test-execution */
// Tests: Slice assignment with runtime variable offsets and lengths
// Validates that offset and length can be variables or expressions
// Ensures the code generator handles non-literal indices correctly

u32 main() {
    u8 buffer[128];

    // Test 1: Variable offset, literal length
    u32 offset <- 0;
    u32 value1 <- 0x11223344;
    buffer[offset, 4] <- value1;

    if (buffer[0] != 0x44) return 1;
    if (buffer[1] != 0x33) return 2;
    if (buffer[2] != 0x22) return 3;
    if (buffer[3] != 0x11) return 4;

    // Test 2: Literal offset, variable length
    u8 len <- 4;
    u32 value2 <- 0x55667788;
    buffer[10, len] <- value2;

    if (buffer[10] != 0x88) return 5;
    if (buffer[11] != 0x77) return 6;
    if (buffer[12] != 0x66) return 7;
    if (buffer[13] != 0x55) return 8;

    // Test 3: Both variable offset and length
    offset <- 20;
    len <- 8;
    u64 value3 <- 0xAABBCCDDEEFF0011;
    buffer[offset, len] <- value3;

    if (buffer[20] != 0x11) return 9;
    if (buffer[21] != 0x00) return 10;
    if (buffer[22] != 0xFF) return 11;
    if (buffer[23] != 0xEE) return 12;
    if (buffer[24] != 0xDD) return 13;
    if (buffer[25] != 0xCC) return 14;
    if (buffer[26] != 0xBB) return 15;
    if (buffer[27] != 0xAA) return 16;

    // Test 4: Expression for offset
    u32 base <- 5;
    u16 value4 <- 0x9988;
    buffer[base + 30, 2] <- value4;

    if (buffer[35] != 0x88) return 17;
    if (buffer[36] != 0x99) return 18;

    // Test 5: Expression for length
    u8 multiplier <- 2;
    u32 value5 <- 0x12345678;
    buffer[40, multiplier * 2] <- value5;

    if (buffer[40] != 0x78) return 19;
    if (buffer[41] != 0x56) return 20;
    if (buffer[42] != 0x34) return 21;
    if (buffer[43] != 0x12) return 22;

    return 0;  // All tests passed
}
