// Test: ADR-016 + ADR-044 Wrap overflow modifier inside scopes
// Verifies that wrap modifier works correctly with integer types inside scope methods
// Tests: wrap variables accessed via this. accessor with compound assignment operators

scope WrapTest {
    // Wrap scope variables - unsigned integers
    wrap u8 byteCounter <- 250;
    wrap u16 tickCount <- 65530;
    wrap u32 cycleCounter <- 4294967290;

    // Wrap scope variables - smaller values for testing wrap-around
    wrap u8 brightness <- 10;
    wrap u16 sensorValue <- 100;
    wrap u32 position <- 50;

    // Public getter methods using this. accessor for wrap variables
    u8 getByteCounter() {
        return this.byteCounter;
    }

    u16 getTickCount() {
        return this.tickCount;
    }

    u32 getCycleCounter() {
        return this.cycleCounter;
    }

    u8 getBrightness() {
        return this.brightness;
    }

    u16 getSensorValue() {
        return this.sensorValue;
    }

    u32 getPosition() {
        return this.position;
    }

    // Increment methods using wrap compound add (+<-)
    // These test overflow wrapping (back to 0 and continue)
    void incrementByteCounter() {
        this.byteCounter +<- 10;  // 250 + 10 = 260 -> wraps to 4
    }

    void incrementTickCount() {
        this.tickCount +<- 10;  // 65530 + 10 = 65540 -> wraps to 4
    }

    void incrementCycleCounter() {
        this.cycleCounter +<- 10;  // Would overflow and wrap
    }

    // Simple increment (no overflow expected)
    void incrementBrightness() {
        this.brightness +<- 5;  // Normal increment, no wrap
    }

    void incrementSensorValue() {
        this.sensorValue +<- 100;  // Normal increment, no wrap
    }

    void incrementPosition() {
        this.position +<- 1000;  // Normal increment, no wrap
    }

    // Decrement methods using wrap compound subtract (-<-)
    // These test underflow wrapping (back to MAX and continue)
    void decrementBrightness() {
        this.brightness -<- 20;  // 10 - 20 = -10 -> wraps to 246
    }

    void decrementSensorValue() {
        this.sensorValue -<- 150;  // 100 - 150 = -50 -> wraps to 65486
    }

    void decrementPosition() {
        this.position -<- 100;  // 50 - 100 = -50 -> wraps to UINT32_MAX - 49
    }

    // Normal decrements (no underflow expected)
    void decrementByteCounter() {
        this.byteCounter -<- 10;  // Normal decrement
    }

    void decrementTickCount() {
        this.tickCount -<- 100;  // Normal decrement
    }

    void decrementCycleCounter() {
        this.cycleCounter -<- 1000;  // Normal decrement
    }

    // Combined operations to test multiple wrap behaviors
    void updateCounters() {
        this.byteCounter +<- 1;
        this.tickCount +<- 1;
        this.cycleCounter +<- 1;
    }

    void adjustValues() {
        this.brightness +<- 10;
        this.sensorValue -<- 50;
        this.position +<- 25;
    }
}

void main() {
    // Test reading wrap values via this. accessor
    WrapTest.getByteCounter();
    WrapTest.getTickCount();
    WrapTest.getCycleCounter();
    WrapTest.getBrightness();
    WrapTest.getSensorValue();
    WrapTest.getPosition();

    // Test wrap overflow operations (add wrapping)
    WrapTest.incrementByteCounter();
    WrapTest.incrementTickCount();
    WrapTest.incrementCycleCounter();

    // Test normal increments
    WrapTest.incrementBrightness();
    WrapTest.incrementSensorValue();
    WrapTest.incrementPosition();

    // Test wrap underflow operations (subtract wrapping)
    WrapTest.decrementBrightness();
    WrapTest.decrementSensorValue();
    WrapTest.decrementPosition();

    // Test normal decrements
    WrapTest.decrementByteCounter();
    WrapTest.decrementTickCount();
    WrapTest.decrementCycleCounter();

    // Test combined operations
    WrapTest.updateCounters();
    WrapTest.adjustValues();
}
