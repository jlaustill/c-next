// test-cpp-only
// test-execution
// Tests: C-Next style array parameters in C++ mode
// Bug: u8[8] param generated as uint8_t& instead of uint8_t param[8]

void fillBuffer(u8[8] buf) {
    buf[0] <- 0xAA;
    buf[1] <- 0xBB;
}

u8 readFirst(const u8[8] data) {
    return data[0];
}

u8 readSecond(const u8[4] data) {
    return data[1];
}

// Test non-const and const array params together
u8 sumFirstTwo(u8[8] buf, const u8[4] ref) {
    buf[0] <- ref[0];
    return buf[0] + ref[1];
}

u32 main() {
    // Test 1: Non-const array param - fill and verify
    u8[8] buffer;
    fillBuffer(buffer);
    if (buffer[0] != 0xAA) return 1;
    if (buffer[1] != 0xBB) return 2;

    // Test 2: Const array param - read from const array
    u8[8] data;
    data[0] <- 42;
    u8 val <- readFirst(data);
    if (val != 42) return 3;

    // Test 3: Different array size const param
    u8[4] small;
    small[1] <- 99;
    u8 val2 <- readSecond(small);
    if (val2 != 99) return 4;

    // Test 4: Mixed const and non-const array params
    u8[4] ref;
    ref[0] <- 10;
    ref[1] <- 20;
    u8[8] dest;
    u8 sum <- sumFirstTwo(dest, ref);
    if (sum != 30) return 5;

    return 0;
}
