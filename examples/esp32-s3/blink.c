/**
 * Generated by C-Next Transpiler
 * A safer C for embedded systems
 */

#include "blink.h"

// =============================================================================
// ESP32-S3 LED Blink Example
// Target: ESP32-S3 with RGB LED on GPIO38
// =============================================================================
#include <stdint.h>
#include <stdbool.h>

#include <stdint.h>
#include <stdbool.h>

// ADR-044: Overflow helper functions
#include <limits.h>

static inline uint32_t cnx_clamp_add_u32(uint32_t a, uint64_t b) {
    if (b > (uint64_t)(UINT32_MAX - a)) return UINT32_MAX;
    uint32_t result;
    if (__builtin_add_overflow(a, (uint32_t)b, &result)) return UINT32_MAX;
    return result;
}

// =============================================================================
// GPIO Pin Bitmaps
// =============================================================================
// GPIO pins 32-48 (bits 0-16 map to GPIO32-48)
// =============================================================================
// IO_MUX Configuration
// =============================================================================
// =============================================================================
// ESP32S3 Hardware Scope
// =============================================================================
/* Scope: ESP32S3 */

/* Register: ESP32S3_GPIO @ 0x60004000 */
#define ESP32S3_GPIO_OUT1 (*(volatile GPIOPins32_48*)(0x60004000 + 0x0010))
#define ESP32S3_GPIO_OUT1_W1TS (*(volatile GPIOPins32_48*)(0x60004000 + 0x0014))
#define ESP32S3_GPIO_OUT1_W1TC (*(volatile GPIOPins32_48*)(0x60004000 + 0x0018))
#define ESP32S3_GPIO_ENABLE1 (*(volatile GPIOPins32_48*)(0x60004000 + 0x002C))
#define ESP32S3_GPIO_ENABLE1_W1TS (*(volatile GPIOPins32_48*)(0x60004000 + 0x0030))
#define ESP32S3_GPIO_ENABLE1_W1TC (*(volatile GPIOPins32_48*)(0x60004000 + 0x0034))
#define ESP32S3_GPIO_IN1 (*(volatile GPIOPins32_48 const *)(0x60004000 + 0x0040))


/* Register: ESP32S3_IO_MUX @ 0x60009000 */
#define ESP32S3_IO_MUX_GPIO38 (*(volatile IOMuxPinConfig*)(0x60009000 + 0x009C))


// =============================================================================
// LED Control Scope (RGB LED on GPIO38)
// =============================================================================
/* Scope: LED */

void LED_init(void) {
    ESP32S3_IO_MUX_GPIO38 = (ESP32S3_IO_MUX_GPIO38 & ~(0x7 << 12)) | ((0 & 0x7) << 12);
    ESP32S3_IO_MUX_GPIO38 = (ESP32S3_IO_MUX_GPIO38 & ~(1 << 9)) | (0 << 9);
    ESP32S3_IO_MUX_GPIO38 = (ESP32S3_IO_MUX_GPIO38 & ~(1 << 8)) | (0 << 8);
    ESP32S3_IO_MUX_GPIO38 = (ESP32S3_IO_MUX_GPIO38 & ~(1 << 7)) | (0 << 7);
    ESP32S3_IO_MUX_GPIO38 = (ESP32S3_IO_MUX_GPIO38 & ~(0x3 << 10)) | (((uint8_t)IODriveStrength_DRIVE_5MA & 0x3) << 10);
    ESP32S3_GPIO_ENABLE1_W1TS = (1 << 6);
    ESP32S3_GPIO_OUT1_W1TC = (1 << 6);
}

void LED_on(void) {
    ESP32S3_GPIO_OUT1_W1TS = (1 << 6);
}

void LED_off(void) {
    ESP32S3_GPIO_OUT1_W1TC = (1 << 6);
}

void LED_toggle(void) {
    if (((ESP32S3_GPIO_OUT1 >> 6) & 1)) {
        LED_off();
    } else {
        LED_on();
    }
}

// =============================================================================
// Simple Delay (busy-wait)
// =============================================================================
void delay(uint32_t cycles) {
    uint32_t i = 0;
    while (i < cycles) {
        i = cnx_clamp_add_u32(i, 1);
    }
}

// =============================================================================
// Main Entry Point
// =============================================================================
int main(void) {
    LED_init();
    while (true) {
        LED_on();
        delay(1000000);
        LED_off();
        delay(1000000);
    }
    return 0;
}
