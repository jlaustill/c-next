// Test that bitmap field assignment on register members generates correct bit manipulation
// Tests this.SysTick.CTRL.ENABLE <- false pattern

#pragma target stm32f4

scope Timer {
    bitmap8 ControlBits {
        ENABLE,         // bit 0
        TICKINT,        // bit 1
        CLKSOURCE,      // bit 2
        Reserved_3,     // bit 3
        Reserved_4,     // bit 4
        Reserved_5,     // bit 5
        Reserved_6,     // bit 6
        Reserved_7      // bit 7
    }

    register SysTick @ 0xE000E010 {
        CTRL: ControlBits rw @ 0x00,
        LOAD: u32 rw @ 0x04,
    }

    public void init() {
        // Test bitmap field assignment
        this.SysTick.CTRL.ENABLE <- false;
        this.SysTick.CTRL.TICKINT <- true;
        this.SysTick.CTRL.CLKSOURCE <- true;

        // Test normal register assignment
        this.SysTick.LOAD <- 16000;
    }
}

void main() {
    Timer.init();
}
