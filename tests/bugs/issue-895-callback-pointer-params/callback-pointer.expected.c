/**
 * Generated by C-Next Transpiler
 * A safer C for embedded systems
 */

// test-transpile-only
// Issue #895: Callback functions with pointer parameters
// Tests that C-Next functions assigned to C callback typedefs
// generate the correct pointer signatures
#include "widget.h"

#include <stdint.h>
#include <stdbool.h>

// This function will be assigned to flush_cb_t typedef
// The typedef expects: void (*)(widget_t *, const rect_t *, uint8_t *)
// So all params should be pointers, not values
void my_flush(widget_t* w, const rect_t* area, uint8_t* buf) {
    widget_flush_was_called = true;
    widget_flush_area_x = area->x;
    widget_flush_area_y = area->y;
    widget_flush_buf_first_byte = (*buf);
}

int main(void) {
    widget_t* w = widget_create();
    widget_set_flush_cb(w, my_flush);
    rect_t area = {0};
    area.x = 10U;
    area.y = 20U;
    area.width = 100U;
    area.height = 50U;
    uint8_t buffer[4] = {0xABU, 0xCDU, 0xEFU, 0x12U};
    widget_trigger_flush(w, &area, buffer);
    bool called = widget_flush_was_called;
    if (!called) return 1;
    uint16_t ax = widget_flush_area_x;
    if (ax != 10) return 2;
    uint16_t ay = widget_flush_area_y;
    if (ay != 20) return 3;
    uint8_t first = widget_flush_buf_first_byte;
    if (first != 0xAB) return 4;
    widget_destroy(w);
    return 0;
}
