// test-execution
// Tests: Issue #213 - Scope helper methods with string parameters
// Validates that slice assignment in private methods generates memcpy, not bitwise ops
// Updated for Issue #234: Uses compile-time constant offsets

scope StringSliceTest {
    // Private helper that performs slice assignment on string parameter
    // Using compile-time constant offset and length
    void copyToBuffer(string<64> buffer, u16 value) {
        buffer[0, 2] <- value;
    }

    void copyToBufferAt2(string<64> buffer, u16 value) {
        buffer[2, 2] <- value;
    }

    public u32 testSliceAssignment() {
        string<64> buffer <- "";

        // Copy 0x1234 into buffer at offset 0
        this.copyToBuffer(buffer, 0x1234);

        // Verify bytes (little-endian) using u8 cast
        u8 byte0 <- buffer[0];
        u8 byte1 <- buffer[1];
        if (byte0 != 0x34) return 1;
        if (byte1 != 0x12) return 2;

        // Copy 0x5678 into buffer at offset 2
        this.copyToBufferAt2(buffer, 0x5678);

        u8 byte2 <- buffer[2];
        u8 byte3 <- buffer[3];
        if (byte2 != 0x78) return 3;
        if (byte3 != 0x56) return 4;

        return 0;
    }
}

u32 main() {
    return StringSliceTest.testSliceAssignment();
}
