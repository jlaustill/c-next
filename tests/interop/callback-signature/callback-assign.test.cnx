// test-execution
// Test: Assigning C-Next function to C callback typedef
// Verifies signature compatibility in both C and C++ modes
#include "callback_types.h"

i32 handler_sum <- 0;

// C-Next function that should be assignable to PointCallback
void my_point_handler(Point p) {
    handler_sum <- p.x + p.y;
}

i32 main() {
    // Test 1: Direct assignment to callback typedef variable
    PointCallback cb <- my_point_handler;
    Point p1 <- {x: 3, y: 7};
    cb(p1);
    if (handler_sum != 10) return 1;

    // Test 2: Reset and call via struct field
    handler_sum <- 0;
    PointHandler handler <- {
        on_point: my_point_handler
    };
    Point p2 <- {x: 5, y: 15};
    handler.on_point(p2);
    if (handler_sum != 20) return 2;

    // Test 3: Pass to C function that calls the callback
    handler_sum <- 0;
    register_callback(my_point_handler);
    if (handler_sum != 30) return 3;

    return 0;
}
