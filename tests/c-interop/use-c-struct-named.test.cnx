/* test-execution */
/* test-coverage: 31-use-c-struct-named */
// Tests: Using non-typedef'd C structs (Issue #196 Bug 3)
// In C, 'struct NamedPoint' is declared but not typedef'd
// Generated C must emit 'struct NamedPoint' not just 'NamedPoint'
// ADR-010: Named struct import from C headers

#include "c-interop/structs.h"

u32 main() {
    // Test 1: Use NamedPoint (declared as 'struct NamedPoint' in C header)
    // Generated C must have: struct NamedPoint pt = {0};
    NamedPoint pt;
    pt.x <- 100;
    pt.y <- 200;
    if (pt.x != 100) return 1;
    if (pt.y != 200) return 2;

    // Test 2: Use NamedConfig (declared as 'struct NamedConfig' in C header)
    // Generated C must have: struct NamedConfig cfg = {0};
    NamedConfig cfg;
    cfg.magic <- 0xCAFEBABE;
    cfg.version <- 0x0102;
    cfg.flags <- 0xFF;
    cfg.checksum <- 0xAA;

    if (cfg.magic != 0xCAFEBABE) return 3;
    if (cfg.version != 0x0102) return 4;
    if (cfg.flags != 0xFF) return 5;
    if (cfg.checksum != 0xAA) return 6;

    // Test 3: Verify field types via .length property
    if (pt.x.length != 32) return 7;
    if (cfg.magic.length != 32) return 8;
    if (cfg.version.length != 16) return 9;
    if (cfg.flags.length != 8) return 10;

    // Test 4: Field assignment from another field
    NamedPoint pt2;
    pt2.x <- pt.x;
    pt2.y <- pt.y;
    if (pt2.x != 100) return 11;
    if (pt2.y != 200) return 12;

    return 0;  // All tests passed
}
