/* test-execution */
// ADR-045: Test string as struct member
// Validates: declaration, initialization, properties, comparison, function passing

struct Person {
    string<64> name;
    string<128> bio;
    u32 age;
}

struct Config {
    string<32> key;
    string<256> value;
}

u32 getNameLength(Person p) {
    return p.name.length;
}

bool compareName(Person p, const string<64> expected) {
    return p.name = expected;
}

i32 main() {
    // Test 1: Basic struct member initialization
    Person alice;
    alice.name <- "Alice";
    alice.bio <- "Software engineer";
    alice.age <- 30;

    if (alice.name.length != 5) return 1;
    if (alice.bio.length != 17) return 2;

    // Test 2: .capacity property on struct member
    if (alice.name.capacity != 64) return 3;
    if (alice.bio.capacity != 128) return 4;

    // Test 3: .size property on struct member
    if (alice.name.size != 65) return 5;
    if (alice.bio.size != 129) return 6;

    // Test 4: Comparison of struct member strings
    if (alice.name != "Alice") return 7;
    if (alice.bio != "Software engineer") return 8;

    // Test 5: Second struct instance
    Person bob;
    bob.name <- "Bob";
    bob.bio <- "Data scientist";
    bob.age <- 25;

    if (bob.name.length != 3) return 9;
    if (bob.name != "Bob") return 10;

    // Test 6: Compare struct members between instances
    if (alice.name = bob.name) return 11;  // Should be different

    // Test 7: Assign same value, compare
    Person charlie;
    charlie.name <- "Alice";  // Same as alice
    if (alice.name != charlie.name) return 12;  // Should be equal

    // Test 8: Pass struct to function, access member
    if (getNameLength(alice) != 5) return 13;
    if (getNameLength(bob) != 3) return 14;

    // Test 9: Function with comparison
    if (!compareName(alice, "Alice")) return 15;
    if (compareName(alice, "Bob")) return 16;  // Should not match

    // Test 10: Config struct (different capacities)
    Config cfg;
    cfg.key <- "api_url";
    cfg.value <- "https://example.com/api/v1";

    if (cfg.key.length != 7) return 17;
    if (cfg.value.length != 26) return 18;
    if (cfg.key.capacity != 32) return 19;
    if (cfg.value.capacity != 256) return 20;

    // Test 11: Empty string member
    Person empty;
    if (empty.name.length != 0) return 21;

    // Test 12: Reassign struct member
    alice.name <- "Alicia";
    if (alice.name.length != 6) return 22;
    if (alice.name != "Alicia") return 23;

    return 0;
}
