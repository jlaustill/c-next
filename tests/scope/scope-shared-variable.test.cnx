// test-execution
// Tests: Scope variables persist like C static variables (Issue #233)
//
// Scope variables are initialized once at program start and persist
// across all function calls, just like C static variables.

scope SharedState {
    // counter persists across all function calls
    u32 counter <- 0;

    public void increment() {
        // counter retains its value from previous calls
        this.counter <- this.counter + 1;
    }

    public u32 getCount() {
        return this.counter;
    }
}

u32 main() {
    // Initial value is 0
    u32 result1 <- SharedState.getCount();
    if (result1 != 0) return 1;

    // Increment: 0 -> 1
    SharedState.increment();
    u32 result2 <- SharedState.getCount();
    if (result2 != 1) return 2;

    // Increment: 1 -> 2 (persists!)
    SharedState.increment();
    u32 result3 <- SharedState.getCount();
    if (result3 != 2) return 3;

    // Increment: 2 -> 3
    SharedState.increment();
    u32 result4 <- SharedState.getCount();
    if (result4 != 3) return 4;

    return 0;
}
