// test-execution
// Tests: Issue #288 - const arrays should also have extern const in headers
// Verifies the fix handles const arrays, not just scalar const variables

scope ConstArrayTest {
    // Public const array - must be declared as "extern const" in header
    public const u8 LOOKUP_TABLE[4] <- [10, 20, 30, 40];

    // Public const scalar for comparison
    public const u8 TABLE_SIZE <- 4;

    public u8 lookup(u8 index) {
        if (index < this.TABLE_SIZE) {
            return this.LOOKUP_TABLE[index];
        }
        return 0;
    }
}

u32 main() {
    // Test 1: Direct array access
    if (ConstArrayTest.LOOKUP_TABLE[0] != 10) return 1;
    if (ConstArrayTest.LOOKUP_TABLE[1] != 20) return 2;
    if (ConstArrayTest.LOOKUP_TABLE[2] != 30) return 3;
    if (ConstArrayTest.LOOKUP_TABLE[3] != 40) return 4;

    // Test 2: Via function (store result first per MISRA Rule 13.5)
    u8 val0 <- ConstArrayTest.lookup(0);
    if (val0 != 10) return 5;

    u8 val2 <- ConstArrayTest.lookup(2);
    if (val2 != 30) return 6;

    // Test 3: Out of bounds returns 0
    u8 outOfBounds <- ConstArrayTest.lookup(10);
    if (outOfBounds != 0) return 7;

    return 0;
}
