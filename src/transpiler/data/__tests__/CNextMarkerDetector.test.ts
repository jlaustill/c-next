import { describe, it, expect } from "vitest";
import CNextMarkerDetector from "../CNextMarkerDetector";

describe("CNextMarkerDetector", () => {
  describe("extractSourcePath", () => {
    it("should extract source path from valid marker", () => {
      const content = `/**
 * Generated by C-Next Transpiler from: led.cnx
 * Header file for cross-language interoperability
 */`;
      expect(CNextMarkerDetector.extractSourcePath(content)).toBe("led.cnx");
    });

    it("should return null for header without marker", () => {
      const content = `/**
 * Some other header
 */
#ifndef FOO_H
#define FOO_H`;
      expect(CNextMarkerDetector.extractSourcePath(content)).toBeNull();
    });

    it("should return null for old-style marker without source path", () => {
      const content = `/**
 * Generated by C-Next Transpiler
 * Header file for cross-language interoperability
 */`;
      expect(CNextMarkerDetector.extractSourcePath(content)).toBeNull();
    });

    it("should handle paths with directories", () => {
      const content = `/**
 * Generated by C-Next Transpiler from: ../lib/utils.cnx
 */`;
      expect(CNextMarkerDetector.extractSourcePath(content)).toBe(
        "../lib/utils.cnx",
      );
    });
  });

  describe("isCNextGenerated", () => {
    it("should return true for C-Next generated header", () => {
      const content = `/**
 * Generated by C-Next Transpiler from: led.cnx
 */`;
      expect(CNextMarkerDetector.isCNextGenerated(content)).toBe(true);
    });

    it("should return true for old-style marker", () => {
      const content = `/**
 * Generated by C-Next Transpiler
 */`;
      expect(CNextMarkerDetector.isCNextGenerated(content)).toBe(true);
    });

    it("should return false for non-generated header", () => {
      const content = `#ifndef FOO_H
#define FOO_H`;
      expect(CNextMarkerDetector.isCNextGenerated(content)).toBe(false);
    });
  });
});
