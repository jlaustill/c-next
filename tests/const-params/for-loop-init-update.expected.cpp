/**
 * Generated by C-Next Transpiler
 * A safer C for embedded systems
 */

#include "for-loop-init-update.test.h"

#include <stdint.h>

// test-execution
// Tests: For loop init and update expressions should be walked for modifying calls
// This tests that function calls in for-init and for-update are detected
/* Scope: Handler */

uint8_t Handler_setValue(Config& cfg, uint32_t val) {
    cfg.value = val;
    return 0;
}

uint32_t Handler_getNext(Config& cfg, uint32_t current) {
    cfg.value = current + 1U;
    return current + 1;
}

// For loop with modifying call in the UPDATE part
void handleForUpdate(Config& config) {
    for (uint32_t i = 0; i < 1; i = Handler_getNext(config, i)) {
    }
}

// For loop with modifying call in the INIT part (via forAssignment)
void handleForInit(Config& config) {
    uint32_t start = 0U;
    for (start = Handler_setValue(config, 10); start < 1; start = start + 1) {
    }
}

int main(void) {
    Config cfg = {0};
    cfg.value = 0U;
    handleForUpdate(cfg);
    if (cfg.value != 1) return 1;
    cfg.value = 0U;
    handleForInit(cfg);
    if (cfg.value != 10) return 2;
    return 0;
}
