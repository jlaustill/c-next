/**
 * Generated by C-Next Transpiler
 * A safer C for embedded systems
 */

#include <stdint.h>

// test-execution
// Tests: Issue #368 - Array parameter element assignment generates bitwise ops instead of array access
// When assigning to an array element via function parameter (data[0] <- value),
// the transpiler should generate array access, not bit manipulation.
// Bug: Unsized array parameters (u8 data[]) generate bit ops; sized arrays (u8 arr[8]) work fine.
// Function that writes to array element by index - UNSIZED parameter (triggers bug)
void writeAt(uint8_t arr[], uint32_t index, uint8_t value) {
    arr[index] = value;
}

// Function that writes to first element with literal index - UNSIZED parameter
void writeFirst(uint8_t data[], uint8_t value) {
    data[0] = value;
}

// Function that reads and writes array elements - UNSIZED parameters
void copyElement(const uint8_t src[], uint8_t dst[], uint32_t index) {
    dst[index] = src[index];
}

int main(void) {
    uint8_t buffer[8] = {0};
    buffer[0] = 0;
    buffer[1] = 0;
    writeAt(buffer, 0, 42);
    if (buffer[0] != 42) return 1;
    writeAt(buffer, 1, 99);
    if (buffer[1] != 99) return 2;
    if (buffer[0] != 42) return 3;
    writeFirst(buffer, 123);
    if (buffer[0] != 123) return 4;
    uint8_t source[4] = {0};
    uint8_t dest[4] = {0};
    source[0] = 0;
    source[1] = 0;
    source[2] = 0;
    source[3] = 0;
    dest[0] = 0;
    dest[1] = 0;
    dest[2] = 0;
    dest[3] = 0;
    source[2] = 200;
    copyElement(source, dest, 2);
    if (dest[2] != 200) return 5;
    return 0;
}
