/**
 * Generated by C-Next Transpiler
 * A safer C for embedded systems
 */

#include <stdint.h>
#include <stdbool.h>

// Postfix Chain Test: Const Expressions in Chains
// Tests: Using const values and expressions as indices in chains
const uint32_t INDEX_0 = 0;

const uint32_t INDEX_1 = 1;

const uint32_t INDEX_2 = 2;

const uint32_t SENSOR_COUNT = 4;

const uint32_t LED_BIT = 3;

const uint32_t STATUS_BIT = 7;

typedef struct Sensor {
    uint32_t id;
    uint8_t data;
} Sensor;

Sensor sensors[4] = {0};

/* Register: GPIO @ 0x40000000 */
#define GPIO_DR (*(volatile uint32_t*)(0x40000000 + 0x00))
#define GPIO_DR_SET (*(volatile uint32_t*)(0x40000000 + 0x84))

int main(void) {
    sensors[INDEX_0].id = 100;
    sensors[INDEX_1].id = 200;
    sensors[INDEX_2].id = 300;
    uint32_t id0 = sensors[INDEX_0].id;
    uint32_t id1 = sensors[INDEX_1].id;
    sensors[INDEX_0].data = 0xFF;
    sensors[INDEX_0].data = (sensors[INDEX_0].data & ~(1 << LED_BIT)) | ((false ? 1 : 0) << LED_BIT);
    sensors[INDEX_0].data = (sensors[INDEX_0].data & ~(1 << STATUS_BIT)) | ((true ? 1 : 0) << STATUS_BIT);
    GPIO_DR = (GPIO_DR & ~(1 << LED_BIT)) | (1 << LED_BIT);
    GPIO_DR = (GPIO_DR & ~(1 << STATUS_BIT)) | (0 << STATUS_BIT);
    GPIO_DR_SET = (1 << LED_BIT);
    const uint32_t COMPUTED_IDX = INDEX_1 + INDEX_1;
    sensors[COMPUTED_IDX].id = 500;
    uint32_t computedId = sensors[COMPUTED_IDX].id;
    sensors[INDEX_0].data = (sensors[INDEX_0].data & ~(1 << LED_BIT)) | ((true ? 1 : 0) << LED_BIT);
    sensors[INDEX_1].data = (sensors[INDEX_1].data & ~(1 << STATUS_BIT)) | ((false ? 1 : 0) << STATUS_BIT);
    if (((sensors[INDEX_0].data >> LED_BIT) & 1) == true) {
        GPIO_DR = (GPIO_DR & ~(1 << LED_BIT)) | (1 << LED_BIT);
    }
    const uint32_t ROW = 0;
    const uint32_t COL = 1;
    const uint32_t FIELD_BIT = 5;
    uint8_t matrix[4][4] = {0};
    matrix[ROW][COL] = 0xFF;
    matrix[ROW][COL] = (matrix[ROW][COL] & ~(1 << FIELD_BIT)) | ((false ? 1 : 0) << FIELD_BIT);
    uint8_t value = matrix[ROW][COL];
    bool bit = ((matrix[ROW][COL] >> FIELD_BIT) & 1);
}
