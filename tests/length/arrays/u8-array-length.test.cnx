// test-execution
// Comprehensive .length test for u8 arrays across all contexts
// Tests: array.length returns 16 (element count), array[0].length returns 8 (element bit width)
u8[16] globalArr;

scope TestScope {
    public u32 getGlobalArrayLength() {
        return global.globalArr.length;
    }
    public u32 getGlobalElementLength() {
        return global.globalArr[0].length;
    }
    u8[16] scopeArr;
    public u32 getScopeArrayLength() {
        return this.scopeArr.length;
    }
    public u32 getScopeElementLength() {
        return this.scopeArr[0].length;
    }
    public u8 publicArr[16];
}

u32 checkArrayLength(u8 arr[16]) {
    return arr.length;
}

u32 checkElementLength(u8 arr[16]) {
    return arr[0].length;
}

struct TestStruct {
    u8[16] arr;
}

i32 main() {
    globalArr[0] <- 42;

    // Test array.length (element count)
    if (globalArr.length != 16) {
        return 1;
    }

    // Test array[0].length (element bit width)
    if (globalArr[0].length != 8) {
        return 2;
    }

    // Scope access - array length
    u32 result <- TestScope.getGlobalArrayLength();
    if (result != 16) {
        return 3;
    }

    // Scope access - element length
    result <- TestScope.getGlobalElementLength();
    if (result != 8) {
        return 4;
    }

    // Scope member - array length
    result <- TestScope.getScopeArrayLength();
    if (result != 16) {
        return 5;
    }

    // Scope member - element length
    result <- TestScope.getScopeElementLength();
    if (result != 8) {
        return 6;
    }

    // Cross-scope - array length
    if (TestScope.publicArr.length != 16) {
        return 7;
    }

    // Cross-scope - element length
    if (TestScope.publicArr[0].length != 8) {
        return 8;
    }

    // Local array
    u8[16] localArr;
    localArr[0] <- 42;
    if (localArr.length != 16) {
        return 9;
    }
    if (localArr[0].length != 8) {
        return 10;
    }

    // Function parameter - array length
    u8[16] testArr;
    testArr[0] <- 42;
    result <- checkArrayLength(testArr);
    if (result != 16) {
        return 11;
    }

    // Function parameter - element length
    result <- checkElementLength(testArr);
    if (result != 8) {
        return 12;
    }

    // Struct member array
    TestStruct ts;
    ts.arr[0] <- 42;
    if (ts.arr.length != 16) {
        return 13;
    }
    if (ts.arr[0].length != 8) {
        return 14;
    }

    return 0;
}
