/* test-coverage: 20-atomic-with-wrap */ // Tests: atomic combined with wrap modifier
// Note: Compilation test only - ARM-specific code
#pragma target teensy41

// Atomic wrap variables - wrapping arithmetic
atomic wrap u8 tick8 <- 0;

atomic wrap u16 tick16 <- 0;

atomic wrap u32 tick32 <- 0;

// Wrap is useful for counters that should overflow
atomic wrap u8 sequenceNumber <- 0;

atomic wrap u16 frameCounter <- 0;

void incrementTicks() {
    tick8 +<- 1; // Wraps from 255 to 0
    tick16 +<- 1; // Wraps from 65535 to 0
    tick32 +<- 1; // Wraps from 4294967295 to 0
}

void nextSequence() {
    sequenceNumber +<- 1;
}

void nextFrame() {
    frameCounter +<- 1;
}

void addToTicks(u32 delta) {
    tick32 +<- delta;
}

void subtractFromTick8(u8 delta) {
    tick8 -<- delta; // Wraps below 0
}

void main() {
    incrementTicks();
    nextSequence();
    nextFrame();
    addToTicks(100);
    subtractFromTick8(10);
}
