/* test-execution */ /* test-coverage: 2.3-this-member, 2.4-this-member, 2.5-this-member, 2.6-this-member, 2.7-this-member, 2.8-this-member, 2.9-this-member, 2.10-this-member, 2.11-this-member */ // Tests: All compound assignment operators with this.member syntax
// Validates: Compound operators -<-, *<-, /<-, %<-, &<-, |<-, ^<-, <<<-, >><- on scope-local members
// Note: +<- is already tested in scope/scope-compound-assign.test.cnx
scope Calculator {
    i32 value <- 0;
    u32 bits <- 0;
    // ===== SUBTRACTION (-<-) =====
    i32 testSubtraction() {
        this.value <- 100;
        this.value -<- 30;
        if (this.value != 70) return 1;

        this.value <- 50;
        this.value -<- 50;
        if (this.value != 0) return 2;

        return 0;
    }
    // ===== MULTIPLICATION (*<-) =====
    i32 testMultiplication() {
        this.value <- 7;
        this.value *<- 6;
        if (this.value != 42) return 10;

        this.value <- 100;
        this.value *<- 1;
        if (this.value != 100) return 11;

        this.value <- 25;
        this.value *<- 0;
        if (this.value != 0) return 12;

        return 0;
    }
    // ===== DIVISION (/<-) =====
    i32 testDivision() {
        this.value <- 100;
        this.value /<- 5;
        if (this.value != 20) return 20;

        this.value <- 81;
        this.value /<- 9;
        if (this.value != 9) return 21;

        this.value <- 50;
        this.value /<- 1;
        if (this.value != 50) return 22;

        return 0;
    }
    // ===== MODULO (%<-) =====
    i32 testModulo() {
        this.value <- 17;
        this.value %<- 5;
        if (this.value != 2) return 30;

        this.value <- 100;
        this.value %<- 7;
        if (this.value != 2) return 31;

        this.value <- 25;
        this.value %<- 25;
        if (this.value != 0) return 32;

        return 0;
    }
    // ===== BITWISE AND (&<-) =====
    i32 testBitwiseAnd() {
        this.bits <- 0xFF;
        this.bits &<- 0x0F;
        if (this.bits != 0x0F) return 40;

        this.bits <- 0xAA;
        this.bits &<- 0x55;
        if (this.bits != 0) return 41;

        this.bits <- 0x12345678;
        this.bits &<- 0xFFFFFFFF;
        if (this.bits != 0x12345678) return 42;

        return 0;
    }
    // ===== BITWISE OR (|<-) =====
    i32 testBitwiseOr() {
        this.bits <- 0xF0;
        this.bits |<- 0x0F;
        if (this.bits != 0xFF) return 50;

        this.bits <- 0x00;
        this.bits |<- 0xAB;
        if (this.bits != 0xAB) return 51;

        this.bits <- 0x12340000;
        this.bits |<- 0x00005678;
        if (this.bits != 0x12345678) return 52;

        return 0;
    }
    // ===== BITWISE XOR (^<-) =====
    i32 testBitwiseXor() {
        this.bits <- 0xFF;
        this.bits ^<- 0xFF;
        if (this.bits != 0) return 60;

        this.bits <- 0xAA;
        this.bits ^<- 0x55;
        if (this.bits != 0xFF) return 61;

        this.bits <- 0x12345678;
        this.bits ^<- 0x00000000;
        if (this.bits != 0x12345678) return 62;

        return 0;
    }
    // ===== LEFT SHIFT (<<<-) =====
    i32 testLeftShift() {
        this.bits <- 1;
        this.bits <<<- 4;
        if (this.bits != 16) return 70;

        this.bits <- 0xFF;
        this.bits <<<- 8;
        if (this.bits != 0xFF00) return 71;

        this.bits <- 1;
        this.bits <<<- 0;
        if (this.bits != 1) return 72;

        return 0;
    }
    // ===== RIGHT SHIFT (>><-) =====
    i32 testRightShift() {
        this.bits <- 256;
        this.bits >><- 4;
        if (this.bits != 16) return 80;

        this.bits <- 0xFF00;
        this.bits >><- 8;
        if (this.bits != 0xFF) return 81;

        this.bits <- 128;
        this.bits >><- 0;
        if (this.bits != 128) return 82;

        return 0;
    }
    // Run all tests
    public i32 runAllTests() {
        i32 result <- 0;

        result <- this.testSubtraction();
        if (result != 0) return result;

        result <- this.testMultiplication();
        if (result != 0) return result;

        result <- this.testDivision();
        if (result != 0) return result;

        result <- this.testModulo();
        if (result != 0) return result;

        result <- this.testBitwiseAnd();
        if (result != 0) return result;

        result <- this.testBitwiseOr();
        if (result != 0) return result;

        result <- this.testBitwiseXor();
        if (result != 0) return result;

        result <- this.testLeftShift();
        if (result != 0) return result;

        result <- this.testRightShift();
        if (result != 0) return result;

        return 0;
    }
}

u32 main() {
    return Calculator.runAllTests();
}
