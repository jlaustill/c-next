/**
 * Generated by C-Next Transpiler
 * A safer C for embedded systems
 */

#include "SerialHandler.test.h"

// test-cpp-only
// test-transpile-only
// Issue #580: Incorrect const inference when parameter is only passed to mutating function
// handleReset was incorrectly marked const even though it passes config to reset() which mutates it
#include "Config.h"
#include "CommandHandler.h"
#include "Serial.h"

#include <stdint.h>

/* Scope: SerialHandler */

void SerialHandler_handleReset(Config& config) {
    Serial_println(1);
    CommandHandler_reset(config);
    Serial_println(2);
}

void SerialHandler_handlePreset(Config& config) {
    if (config.value < 10) {
        Serial_println(3);
        return;
    }
    uint8_t input = 1;
    uint8_t preset = 2;
    CommandHandler_applyPreset(config, input, preset);
}

void SerialHandler_handleSave(Config& config) {
    CommandHandler_reset(config);
}

int main(void) {
    Config c = (Config){ .value = 0 };
    SerialHandler_handleReset(c);
}
