// test-execution
// ADR-003/ADR-045: Static string buffer allocation
// Tests: global string buffers with known sizes are valid
// Issues #138 and #139 fixed: string assignment now works correctly
string<64> messageBuffer <- "Initial";

string<128> logBuffer <- "Log entry one";

u32 getMessageLength() {
    return messageBuffer.char_count;
}

u32 getLogLength() {
    return logBuffer.char_count;
}

// Issue #138 fixed: assignment from const parameter now generates valid C
void copyMessage(const string<64> source) {
    messageBuffer <- source;
}

// Issue #139 fixed: string literal assignment in function body now works
void setDefaultMessage() {
    messageBuffer <- "DefaultValue";
}

u32 main() {
   
// Test 1: Global string buffers are initialized correctly
    if (messageBuffer.char_count != 7) return 1; // "Initial"
    if (logBuffer.char_count != 13) return 2; // "Log entry one"

   
// Test 2: Content comparison
    if (messageBuffer != "Initial") return 3;
    if (logBuffer != "Log entry one") return 4;

   
// Test 3: Capacity is correct
    if (messageBuffer.capacity != 64) return 5;
    if (logBuffer.capacity != 128) return 6;

   
// Test 4: Size is correct (capacity + 1)
    if (messageBuffer.size != 65) return 7;
    if (logBuffer.size != 129) return 8;

   
// Test 5: Access length via function
    u32 msgLen <- getMessageLength();
    if (msgLen != 7) return 9;
    u32 logLen <- getLogLength();
    if (logLen != 13) return 10;

   
// Test 6: Modify global buffer directly (issue #139)
    messageBuffer <- "Modified";
    if (messageBuffer.char_count != 8) return 11;
    if (messageBuffer != "Modified") return 12;

   
// Test 7: Copy from parameter (issue #138)
    string<64> source <- "FromParam";
    copyMessage(source);
    if (messageBuffer.char_count != 9) return 13;
    if (messageBuffer != "FromParam") return 14;

   
// Test 8: Set from literal in function (issue #139)
    setDefaultMessage();
    if (messageBuffer.char_count != 12) return 15;
    if (messageBuffer != "DefaultValue") return 16;

    return 0;
}
