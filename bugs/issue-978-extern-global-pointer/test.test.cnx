// test-no-exec
// Issue #978: External global of concrete struct type passed by value
// instead of by reference when calling C function expecting pointer
#include "fake_lib.h"

scope App {
    // Case 1: struct value -> pointer param (SHOULD add &)
    public void init() {
        global.set_font(big_font);
    }

    // Case 2: pointer var -> pointer param (should NOT add &)
    public void init_from_ptr() {
        global.set_font(font_ptr);
    }

    // Case 3: struct value -> by-value param (should NOT add &)
    public void copy() {
        global.copy_font(big_font);
    }
}

u32 main() {
    App.init();

    // Verify set_font received a pointer to big_font (not a copy)
    i32 ok <- global.was_font_set_correctly();
    if (ok != 1) return 1;

    return 0;
}
