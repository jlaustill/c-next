/**
 * Generated by C-Next Transpiler
 * A safer C for embedded systems
 */

#include <stdint.h>

/* test-execution */
// Regression test for issue #69: Array indexing transpiles as bitshift operation
//
// Bug: Array indexing on struct array members like config.tempInputs[index].assignedSpn
// was incorrectly transpiling as bitshift: ((config.tempInputs >> index) & 1).assignedSpn
//
// Expected: config->tempInputs[index].assignedSpn
//
// This test ensures the bug does not regress in future changes.
typedef struct {
    uint16_t assignedSpn;
    float coeffA;
} InputData;

typedef struct {
    InputData tempInputs[8];
} Configuration;

// Function that exposes the bug - passing struct by value with array member access
uint16_t getSpn(const Configuration* conf, uint32_t* idx) {
    return conf->tempInputs[(*idx)].assignedSpn;
}

float getCoeff(const Configuration* data, uint32_t* pos) {
    return data->tempInputs[(*pos)].coeffA;
}

int main(void) {
    Configuration cfg = {0};
    cfg.tempInputs[0].assignedSpn = 100;
    cfg.tempInputs[0].coeffA = 1.5;
    cfg.tempInputs[1].assignedSpn = 200;
    cfg.tempInputs[1].coeffA = 2.5;
    cfg.tempInputs[2].assignedSpn = 300;
    cfg.tempInputs[2].coeffA = 3.5;
    cfg.tempInputs[5].assignedSpn = 999;
    cfg.tempInputs[5].coeffA = 9.9;
    uint32_t idx0 = 0;
    uint32_t idx1 = 1;
    uint32_t idx2 = 2;
    uint32_t idx5 = 5;
    if (getSpn(&cfg, &idx0) != 100) return 1;
    if (getSpn(&cfg, &idx1) != 200) return 2;
    if (getSpn(&cfg, &idx2) != 300) return 3;
    if (getSpn(&cfg, &idx5) != 999) return 4;
    if (getCoeff(&cfg, &idx0) != 1.5) return 5;
    if (getCoeff(&cfg, &idx1) != 2.5) return 6;
    if (getCoeff(&cfg, &idx2) != 3.5) return 7;
    if (cfg.tempInputs[0].assignedSpn != 100) return 8;
    if (cfg.tempInputs[1].assignedSpn != 200) return 9;
    if (cfg.tempInputs[2].assignedSpn != 300) return 10;
    uint16_t sum = cfg.tempInputs[0].assignedSpn + cfg.tempInputs[1].assignedSpn;
    if (sum != 300) return 11;
    uint16_t val = getSpn(&cfg, &idx2);
    if (val != 300) return 12;
    if ((cfg.tempInputs[0].assignedSpn + cfg.tempInputs[2].assignedSpn) != 400) return 13;
    return 0;
}
