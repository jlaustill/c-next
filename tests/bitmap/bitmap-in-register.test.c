/**
 * Generated by C-Next Transpiler from: bitmap-in-register.test.cnx
 * A safer C for embedded systems
 */

#include <stdint.h>
#include <stdbool.h>

// ADR-034 + ADR-004: Bitmap inside Register Test
// This is the "million dollar feature" - using bitmaps for type-safe hardware registers
// Define a bitmap for motor control register
/* Bitmap: MotorControl */
/* Fields:
 *   Running: bit 0 (1 bit)
 *   Direction: bit 1 (1 bit)
 *   Fault: bit 2 (1 bit)
 *   Mode: bits 3-5 (3 bits)
 *   Reserved: bits 6-7 (2 bits)
 */
typedef uint8_t MotorControl;

// Use bitmap type inside a register definition
/* Register: MOTOR @ 0x40001000 */
#define MOTOR_CTRL (*(volatile MotorControl*)(0x40001000 + 0x00))
#define MOTOR_STATUS (*(volatile uint8_t const *)(0x40001000 + 0x04))

int main(void) {
    MOTOR_CTRL = (MOTOR_CTRL & ~(1U << 0)) | (1U << 0);
    MOTOR_CTRL = (MOTOR_CTRL & ~(1U << 1)) | (0U << 1);
    MOTOR_CTRL = (MOTOR_CTRL & ~(0x7U << 3)) | ((5 & 0x7U) << 3);
    bool isRunning = ((((MOTOR_CTRL >> 0) & 1)) != 0U);
    uint8_t mode = (uint8_t)((MOTOR_CTRL >> 3) & 0x7);
    if (((MOTOR_CTRL >> 2) & 1) == true) {
        MOTOR_CTRL = (MOTOR_CTRL & ~(0x7U << 3)) | ((0 & 0x7U) << 3);
    }
}
