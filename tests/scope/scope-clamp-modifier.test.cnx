// test-execution
// Test: ADR-016 + ADR-044 Clamp overflow modifier inside scopes
// Verifies that clamp modifier works correctly with integer types inside scope methods
// Tests: clamp variables accessed via this. accessor with compound assignment operators

scope ClampTest {
    // Clamp scope variables - unsigned integers
    clamp u8 brightness <- 200;
    clamp u16 sensorValue <- 60000;
    clamp u32 counter <- 4000000000;

    // Clamp scope variables - signed integers
    clamp i8 temperature <- -100;
    clamp i16 altitude <- 30000;
    clamp i32 position <- 2000000000;

    // Public getter methods using this. accessor for clamp variables
    public u8 getBrightness() {
        return this.brightness;
    }

    public u16 getSensorValue() {
        return this.sensorValue;
    }

    public u32 getCounter() {
        return this.counter;
    }

    public i8 getTemperature() {
        return this.temperature;
    }

    public i16 getAltitude() {
        return this.altitude;
    }

    public i32 getPosition() {
        return this.position;
    }

    // Increment methods using clamp compound add (+<-)
    // These test overflow clamping to maximum values
    public void increaseBrightness() {
        this.brightness +<- 100;  // Would overflow, clamps to 255
    }

    public void increaseSensorValue() {
        this.sensorValue +<- 10000;  // Would overflow, clamps to 65535
    }

    public void increaseCounter() {
        this.counter +<- 500000000;  // Would overflow, clamps to UINT32_MAX
    }

    // Decrement methods using clamp compound subtract (-<-)
    // These test underflow clamping to minimum values
    public void decreaseTemperature() {
        this.temperature -<- 50;  // Would underflow, clamps to -128
    }

    public void decreaseAltitude() {
        this.altitude -<- 5000;  // Normal decrease, no clamping needed
    }

    public void decreasePosition() {
        this.position -<- 100000000;  // Normal decrease, no clamping needed
    }


// Test unsigned underflow - clamps to 0
    public void dimBrightness() {
        this.brightness -<- 250;  // Would underflow, clamps to 0
    }

    public void resetSensor() {
        this.sensorValue -<- 65000;  // Would underflow, clamps to 0
    }

    // Setter methods for resetting state between tests
    public void setBrightness(u8 val) {
        this.brightness <- val;
    }

    public void setSensorValue(u16 val) {
        this.sensorValue <- val;
    }
}

u32 main() {

// Test 1-6: Validate initial values
    u8 resultBrightness <- ClampTest.getBrightness();
    if (resultBrightness != 200) return 1;
    u16 resultSensor <- ClampTest.getSensorValue();
    if (resultSensor != 60000) return 2;
    u32 resultCounter <- ClampTest.getCounter();
    if (resultCounter != 4000000000) return 3;
    i8 resultTemp <- ClampTest.getTemperature();
    if (resultTemp != -100) return 4;
    i16 resultAlt <- ClampTest.getAltitude();
    if (resultAlt != 30000) return 5;
    i32 resultPos <- ClampTest.getPosition();
    if (resultPos != 2000000000) return 6;


// Test 7: u8 overflow clamps to 255 (200 + 100 = 300 -> 255)
    ClampTest.increaseBrightness();
    resultBrightness <- ClampTest.getBrightness();
    if (resultBrightness != 255) return 7;


// Test 8: u16 overflow clamps to 65535 (60000 + 10000 = 70000 -> 65535)
    ClampTest.increaseSensorValue();
    resultSensor <- ClampTest.getSensorValue();
    if (resultSensor != 65535) return 8;


// Test 9: u32 overflow clamps to UINT32_MAX
    ClampTest.increaseCounter();
    resultCounter <- ClampTest.getCounter();
    if (resultCounter != 4294967295) return 9;


// Test 10: i8 underflow clamps to -128 (-100 - 50 = -150 -> -128)
    ClampTest.decreaseTemperature();
    resultTemp <- ClampTest.getTemperature();
    if (resultTemp != -128) return 10;


// Test 11: i16 normal decrease (30000 - 5000 = 25000)
    ClampTest.decreaseAltitude();
    resultAlt <- ClampTest.getAltitude();
    if (resultAlt != 25000) return 11;


// Test 12: i32 normal decrease (2000000000 - 100000000 = 1900000000)
    ClampTest.decreasePosition();
    resultPos <- ClampTest.getPosition();
    if (resultPos != 1900000000) return 12;


// Test 13: u8 underflow clamps to 0 (255 - 250 = 5, then need fresh test)
    // Reset brightness to test underflow
    ClampTest.setBrightness(100);
    ClampTest.dimBrightness();  // 100 - 250 = -150 -> clamps to 0
    resultBrightness <- ClampTest.getBrightness();
    if (resultBrightness != 0) return 13;


// Test 14: u16 underflow clamps to 0
    ClampTest.setSensorValue(1000);
    ClampTest.resetSensor();  // 1000 - 65000 = -64000 -> clamps to 0
    resultSensor <- ClampTest.getSensorValue();
    if (resultSensor != 0) return 14;

    // All 14 validations passed
    return 0;
}
