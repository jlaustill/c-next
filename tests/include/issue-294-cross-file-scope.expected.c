/**
 * Generated by C-Next Transpiler
 * A safer C for embedded systems
 */

// Issue #294: Cross-file scope function calls
// Note: This is a snapshot test, not an execution test, because the decoder
// scope is in a separate file that would need to be compiled and linked separately.
// Tests that including a file with a scope allows calling that scope's
// public functions, and the generated code uses underscore notation
// (e.g., decoder_getSpn) not dot notation (decoder.getSpn)
#include <issue-294-decoder.h>

#include <stdint.h>

/* Scope: handler */

uint16_t handler_processData(const uint8_t data[8]) {
    uint16_t spn = decoder_getSpn(data);
    return spn;
}

uint8_t handler_extractByte(const uint8_t data[8], uint8_t idx) {
    return decoder_getByte(data, idx);
}

int main(void) {
    uint8_t testData[8] = {0};
    testData[0] = 0x34;
    testData[1] = 0x12;
    testData[2] = 0xAB;
    testData[3] = 0xCD;
    testData[4] = 0x00;
    testData[5] = 0x00;
    testData[6] = 0x00;
    testData[7] = 0x00;
    uint16_t spn = decoder_getSpn(testData);
    if (spn != 4660) return 1;
    uint8_t byte0 = decoder_getByte(testData, 0);
    if (byte0 != 0x34) return 2;
    uint8_t byte1 = decoder_getByte(testData, 1);
    if (byte1 != 0x12) return 3;
    uint8_t byte2 = decoder_getByte(testData, 2);
    if (byte2 != 0xAB) return 4;
    uint16_t spn2 = handler_processData(testData);
    if (spn2 != 4660) return 5;
    uint8_t extracted = handler_extractByte(testData, 3);
    if (extracted != 0xCD) return 6;
    return 0;
}
